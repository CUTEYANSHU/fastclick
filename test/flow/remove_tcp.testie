%script
click CONFIG --simtime

%file CONFIG
FromIPSummaryDump(RX, STOP true, CHECKSUM true, TIMING true)
-> Print("IN",-1)
-> FlowClassifier(VERBOSE 2, CONTEXT NONE)
~> IPIn
-> IPPrint(RX)
-> TCPReorder(VERBOSE 1)
-> IPPrint(RXORDER)
-> tcpin_rx2 :: TCPIn(RETURNNAME tcpin_tx2, VERBOSE true)
-> IPPrint(RXTCP)
-> InsultRemover(WORD is, MODE REMOVE)
-> Print("OUTR",-1)
-> IPPrint("OUTR")
-> to_rx :: TCPOut
-> IPOut
-> out_rx :: Print("OUT",-1)
-> IPPrint("OUT")
-> tee  :: Tee -> FlowStack(RELEASE true) -> ToIPSummaryDump(REMOVE, FIELDS wire_len tcp_seq tcp_ack tcp_flags payload);

to_rx[1] -> out_rx;

tee[1] 
-> FlowStack(RELEASE false)
-> TCPReflector(STRIP_PAYLOAD true, RAND_SEQ false)
-> FlowClassifier(VERBOSE 0, CONTEXT NONE)
-> Print("TX",-1)
~> IPIn
-> IPPrint(TX)
-> TCPReorder(VERBOSE 1)
-> tcpin_tx2 :: TCPIn(RETURNNAME tcpin_rx2, VERBOSE true)
-> to_tx :: TCPOut
-> IPOut
-> IPPrint(TXOUT)
-> Discard


%file RX
!data timestamp src sport dst dport proto tcp_seq tcp_ack tcp_flags payload
1 18.26.4.44 2222 18.26.4.44 22 T 1000    0 S
3 18.26.4.44 2222 18.26.4.44 22 T 1001 1001001 A
4 18.26.4.44 2222 18.26.4.44 22 T 1001 1001001 . thisisan
6 18.26.4.44 2222 18.26.4.44 22 T 1009 1001001 . at
7 18.26.4.44 2222 18.26.4.44 22 T 1011 1001001 . tack
7 18.26.4.44 2222 18.26.4.44 22 T 1015 1001001 F

8 18.26.4.44 2322 18.26.4.45 22 T 1000    0 S
9 18.26.4.44 2322 18.26.4.45 22 T 1001 1001001 A
10 18.26.4.44 2322 18.26.4.45 22 T 1001 1001001 . thi
11 18.26.4.44 2322 18.26.4.45 22 T 1004 1001001 . sais
12 18.26.4.44 2322 18.26.4.45 22 T 1008 1001001 . acat
13 18.26.4.44 2322 18.26.4.45 22 T 1012 1001001 . is
14 18.26.4.44 2322 18.26.4.45 22 T 1014 1001001 . beautifull
15 18.26.4.44 2322 18.26.4.45 22 T 1024 1001001 F


%expect REMOVE
!IPSummaryDump 1.3
!data wire_len tcp_seq tcp_ack tcp_flags payload
40 1000 0 S ""
40 1001 1001001 A ""
44 1001 1001001 . "than"
42 1005 1001001 . "at"
44 1007 1001001 . "tack"
40 1011 1001001 F ""
40 1000 0 S ""
40 1001 1001001 A ""
40 1001001 1004 A ""
42 1001 1001001 . "th"
41 1003 1001001 . "a"
44 1004 1001001 . "acat"
40 1001001 1014 A ""
40 1008 1001001 . ""
50 1008 1001001 . "beautifull"
40 1018 1001001 F ""

